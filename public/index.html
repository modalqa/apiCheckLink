<!DOCTYPE html>
<html>
<head>
  <title>Link Checker</title>
  <!-- Tambahkan Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .btn-group button {
      margin-right: 10px; /* Menambahkan margin kanan sebesar 10px */
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mt-5 mb-3">Link Checker</h1>

    <!-- Form untuk memasukkan URL -->
    <form action="http://localhost:3000/check-links" method="post">
      <div class="form-group">
        <label for="url">URL to Check:</label>
        <input type="text" class="form-control" id="url" name="url" required>
      </div>
      <div class="btn-group">
        <button type="submit" class="btn btn-primary">Check Links</button>
        <button id="download-csv" class="btn btn-primary" disabled>Download Result</button>
      </div>
    </form>

    <!-- Hasil pemeriksaan tautan -->
    <div class="mt-4">
      <h3>Results</h3>
      <p>URL: <span id="result-url"></span></p>
      <p>Total Links: <span id="result-link-count"></span></p>
      <p>Broken Links: <span id="result-broken-count"></span></p>
      <p>Green Links: <span id="result-green-count"></span></p>
    </div>

    <!-- Tambahkan tautan ke Saweria.co/qamodern -->
    <footer>
      <p>Support the QA Engineer: <a href="https://saweria.co/qamodern" target="_blank">Donate on Saweria</a></p>
    </footer>
  </div>

  <!-- Tambahkan Bootstrap JavaScript dan jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    $(document).ready(function () {
      $('form').submit(function (event) {
        event.preventDefault();

        const url = $('#url').val();

        $.post('http://localhost:3000/check-links', { url }, function (data) {
          $('#result-url').text(data.url);
          $('#result-link-count').text(data.linkCount);
          $('#result-broken-count').text(data.brokenCount);
          $('#result-green-count').text(data.greenCount);

          // Hapus atribut 'disabled' dari tombol "Download Result" untuk mengaktifkannya
          $('#download-csv').removeAttr('disabled');
        });
      });

      // Menangani klik tombol unduh
      $('#download-csv').click(function () {
        const url = $('#url').val();
        $.post('http://localhost:3000/check-links', { url }, function (data) {
          const checkedLinks = data.linkStatuses; // Ambil daftar tautan dari respons server

          // Buat data CSV
          let csvContent = "URL,Status\n";
          checkedLinks.forEach(function (link) {
            csvContent += `"${link.link}","${link.status}"\n`;
          });

          // Buat objek Blob untuk file CSV
          const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });

          // Buat nama file dinamis dengan tanggal dan waktu
          const now = new Date();
          const formattedDate = now.toLocaleDateString().replace(/\//g, '-');
          const formattedTime = now.toLocaleTimeString().replace(/:/g, '-');
          const fileName = `checked_links_${formattedDate}_${formattedTime}.csv`;

          // Buat tautan unduhan
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = fileName;

          // Klik tautan unduhan secara otomatis
          link.click();
        });
      });
    });
  </script>
</body>
</html>
